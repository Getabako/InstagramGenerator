# ファイルアップロード機能 セットアップガイド

## 概要

このシステムには3つの機能があります：
1. **画像生成** - Instagram用の画像を生成
2. **ファイルアップロード** - フォルダごとimages.if-juku.netにアップロード
3. **CSV作成** - Instagram一括投稿用のCSVを生成

## セットアップ手順

### 1. パスワードの設定

`upload.php` の17行目を編集してください：

```php
define('UPLOAD_PASSWORD', 'your_secure_password_here'); // ★★★ここにパスワードを設定してください★★★
```

**重要**: 強固なパスワードを設定してください（推奨：16文字以上の英数字記号の組み合わせ）

### 2. ファイルのアップロード

エックスサーバーのファイルマネージャーまたはFTPクライアントを使用して、以下のファイルを `images.if-juku.net` のルートディレクトリにアップロードしてください：

- `upload.php` - アップロード処理用PHPファイル
- `.htaccess_for_upload` → `.htaccess` にリネーム

### 3. パーミッションの設定

エックスサーバーのファイルマネージャーで以下のパーミッションを設定：

- `upload.php` → **644** または **604**
- `.htaccess` → **644**
- アップロード先のフォルダ → **755**

### 4. 動作確認

1. `index.html` をブラウザで開く
2. 「ファイルアップロード」タブをクリック
3. 設定したパスワードを入力
4. テスト用のフォルダをドラッグ&ドロップ
5. 「アップロード開始」をクリック

## 使い方

### フォルダアップロード

1. パスワードを入力
2. フォルダをドラッグ&ドロップ、または「フォルダを選択」ボタンをクリック
3. アップロード予定ファイル一覧を確認
4. 「アップロード開始」ボタンをクリック

### アップロード後のURL

フォルダ構造がそのまま保持されます：

```
アップロードしたフォルダ構造:
aaa/
  ├── 001.png
  ├── 002.png
  └── iftech_thanks.png

生成されるURL:
https://images.if-juku.net/aaa/001.png
https://images.if-juku.net/aaa/002.png
https://images.if-juku.net/aaa/iftech_thanks.png
```

## 対応ファイル形式

- PNG (.png)
- JPEG (.jpg, .jpeg)
- GIF (.gif)
- WebP (.webp)
- SVG (.svg)

## セキュリティ設定

### パスワード認証
- アップロード時にパスワード認証が必要
- パスワードは `upload.php` に設定

### ファイル制限
- 最大ファイルサイズ: 10MB
- 画像ファイルのみアップロード可能
- ディレクトリトラバーサル攻撃対策済み

### アクセス制限
- `upload.php` はPOSTリクエストのみ受け付け
- ディレクトリリスティング無効化
- セキュリティヘッダー設定済み

## トラブルシューティング

### アップロードが失敗する場合

1. **パスワードが正しくありません**
   - `upload.php` のパスワード設定を確認してください

2. **ファイルの保存に失敗しました**
   - パーミッション設定を確認してください
   - 親ディレクトリが書き込み可能か確認してください

3. **ファイルサイズが大きすぎます**
   - ファイルサイズを10MB以下にしてください
   - または `upload.php` の設定を変更してください

4. **CORS エラー**
   - `upload.php` の6行目を確認してください
   - 必要に応じてオリジンを制限してください

### エックスサーバーの設定

エックスサーバーのサーバーパネルから以下を確認：
- PHP動作確認（バージョン7.4以上推奨）
- `upload_max_filesize` と `post_max_size` の設定

## 注意事項

1. **パスワードの管理**
   - パスワードは第三者に知られないよう厳重に管理してください
   - 定期的にパスワードを変更することを推奨します

2. **ディスク容量**
   - エックスサーバーのディスク使用量を定期的に確認してください
   - 不要なファイルは削除してください

3. **バックアップ**
   - 重要なファイルは定期的にバックアップしてください

## ファイル構成

```
InstagramGenerator-main/
├── index.html                  # メインアプリケーション（3タブ構成）
├── upload.php                  # アップロード処理用PHP
├── .htaccess_for_upload       # セキュリティ設定用（.htaccessにリネーム）
├── imagelink.gs               # GAS版（参考用）
├── 一括投稿データ - シート1.csv  # CSV形式の参考データ
├── UPLOAD_SETUP.md            # このファイル
└── README.md                   # プロジェクト概要

images.if-juku.net/ （エックスサーバー）
├── upload.php                  # アップロード処理用PHP
├── .htaccess                   # セキュリティ設定
└── (アップロードされたフォルダとファイル)
```

## サポート

問題が発生した場合は、以下を確認してください：
1. ブラウザのコンソールログ（F12キーで開く）
2. エックスサーバーのエラーログ
3. `upload.php` のエラーメッセージ

---

**最終更新**: 2025年10月
